{"version":3,"file":"review-outline-view.js","sourceRoot":"","sources":["review-outline-view.ts"],"names":["ReVIEWOutlineView","ReVIEWOutlineView.constructor","ReVIEWOutlineView.activate","ReVIEWOutlineView.jq","ReVIEWOutlineView.getFilterKey","ReVIEWOutlineView.toggle","ReVIEWOutlineView.attach","ReVIEWOutlineView.cancelled","ReVIEWOutlineView.viewForItem","ReVIEWOutlineView.confirmed"],"mappings":"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","sourcesContent":["import {SelectListView, $, $$} from \"atom-space-pen-views\";\nimport {Point} from \"atom\";\n\nimport * as ReVIEW from \"review.js\";\n\nimport * as logger from \"../util/logger\";\nimport ReVIEWRunner from \"../util/review-runner\";\n\nexport default class ReVIEWOutlineView extends SelectListView {\n    static activate() {\n        new ReVIEWOutlineView();\n    }\n\n    constructor() {\n        super();\n        this.jq.addClass(\"review-outline overlay from-top\");\n    }\n\n    get jq(): JQuery {\n        // dirty hack\n        return <any>this;\n    }\n\n    getFilterKey() {\n        return \"labelName\";\n    }\n\n    toggle() {\n        if (this.jq.hasParent()) {\n            this.cancel();\n        } else {\n            this.attach();\n        }\n    }\n\n    attach() {\n        this.storeFocusedElement();\n\n        let symbols: ReVIEW.Symbol[] = [];\n\n        let editor = atom.workspace.getActiveTextEditor();\n        let runner = new ReVIEWRunner({ editor: editor });\n        runner.on(\"report\", reports => {\n            logger.log(\"Re:VIEW linter ReVIEWRunner compile\");\n            if (runner.lastSymbols) {\n                let symbols = runner.lastSymbols.filter(symbol => symbol.symbolName === \"hd\");\n                this.setItems(symbols);\n            } else {\n                logger.log(\"not compiled...\");\n                atom.beep();\n            }\n        });\n        runner.doCompile();\n\n        $(atom.views.getView(atom.workspace)).append(this.jq); // TODO is this implementation on the right way?\n        this.focusFilterEditor();\n    }\n\n    cancelled() {\n        this.jq.remove();\n    }\n\n    viewForItem(symbol: ReVIEW.Symbol): JQuery {\n        let repeatString = (times: number, str: string, result = \"\"): string => {\n            if (times === 0) {\n                return result;\n            } else {\n                return repeatString(times - 1, str, result + str);\n            }\n        };\n\n        let header: ReVIEW.HeadlineSyntaxTree = <any>symbol.node;\n        let prefix = repeatString(header.level, \"=\");\n        let text = `${prefix} ${symbol.labelName}`;\n\n        return $$(function() {\n            // this eq View(class)\n            this.li(() => {\n                this.span(text);\n            });\n        });\n    }\n\n    confirmed(symbol: ReVIEW.Symbol) {\n        // onSelected的な\n        this.cancel();\n        // emit したい…\n        let pane: any = atom.workspace.getActivePane();\n        if (!pane || typeof pane.getActiveEditor !== \"function\") {\n            atom.beep();\n            return;\n        }\n        let editor: AtomCore.IEditor = pane.getActiveEditor();\n        let point = Point.fromObject({ row: symbol.node.location.start.line - 1, column: 0 });\n        editor.setCursorBufferPosition(point);\n    }\n}\n"]}